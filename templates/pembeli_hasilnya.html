{% extends "base.html" %}

{% block title %}Hasil Pencarian - Bus Ticket Online{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pembeli_hasilnya.css') }}">
{% endblock %}

{% block content %}
<!-- Loading Overlay -->
<div id="loadingOverlay" class="loading-overlay" style="display: none;">
    <div class="spinner"></div>
    <h3>Memuat hasil pencarian...</h3>
    <p>Mohon tunggu sebentar</p>
</div>

<!-- Header -->
<header class="header">
    <div class="container">
        <div class="header-content">
            <div class="header-brand">
                <h1>
                    <i class="fas fa-bus"></i>
                    Bus Ticket Online
                </h1>
                <p>Hasil Pencarian Tiket Bus</p>
            </div>
            
            <div class="header-actions">
                <div class="user-info">
                    <div class="user-avatar">
                        {{ current_user.nama[0] if current_user.nama else 'U' }}
                    </div>
                    <span>{{ current_user.nama if current_user.nama else 'User' }}</span>
                </div>
                
                <button id="backBtn" class="btn btn-back">
                    <i class="fas fa-arrow-left"></i> Kembali
                </button>
            </div>
        </div>
    </div>
</header>

<main class="container">
    <!-- Page Header -->
    <div class="page-header">
        <h1 class="page-title">
            <i class="fas fa-search"></i>
            Hasil Pencarian Tiket Bus
        </h1>
        <p class="page-subtitle">
            Berikut adalah hasil pencarian tiket bus sesuai dengan kriteria yang Anda cari
        </p>
    </div>

    <!-- Search Info Card -->
    <div class="search-info-card" id="searchInfo">
        <!-- Diisi oleh JavaScript -->
    </div>

    <!-- Filter & Sort Controls -->
    <div class="controls-container">
        <div class="controls-grid">
            <!-- Filter: Bus Type -->
            <div class="filter-group">
                <label class="filter-label">
                    <i class="fas fa-bus"></i> Tipe Bus
                </label>
                <select id="busType" class="filter-select">
                    <!-- Diisi oleh JavaScript -->
                </select>
            </div>

            <!-- Filter: Price Range -->
            <div class="filter-group">
                <label class="filter-label">
                    <i class="fas fa-money-bill-wave"></i> Rentang Harga
                </label>
                <div style="display: flex; gap: 10px;">
                    <input type="number" id="minPrice" class="filter-input" placeholder="Min" min="0">
                    <input type="number" id="maxPrice" class="filter-input" placeholder="Max" min="0">
                </div>
            </div>

            <!-- Filter: Facilities -->
            <div class="filter-group">
                <label class="filter-label">
                    <i class="fas fa-concierge-bell"></i> Fasilitas
                </label>
                <div id="facilitiesFilter" class="facilities-checkboxes">
                    <!-- Diisi oleh JavaScript -->
                </div>
            </div>

            <!-- Filter: Operator -->
            <div class="filter-group">
                <label class="filter-label">
                    <i class="fas fa-building"></i> Operator
                </label>
                <select id="operator" class="filter-select">
                    <!-- Diisi oleh JavaScript -->
                </select>
            </div>

            <!-- Filter: Departure Time -->
            <div class="filter-group">
                <label class="filter-label">
                    <i class="fas fa-clock"></i> Waktu Keberangkatan
                </label>
                <select id="departureTime" class="filter-select">
                    <option value="">Semua Waktu</option>
                    <option value="morning">Pagi (00:00 - 11:59)</option>
                    <option value="afternoon">Siang (12:00 - 17:59)</option>
                    <option value="evening">Malam (18:00 - 23:59)</option>
                </select>
            </div>

            <!-- Filter: Sort By -->
            <div class="filter-group">
                <label class="filter-label">
                    <i class="fas fa-sort"></i> Urutkan Berdasarkan
                </label>
                <select id="sortBy" class="filter-select">
                    <!-- Diisi oleh JavaScript -->
                </select>
            </div>

            <!-- Action Buttons -->
            <div class="filter-group">
                <label class="filter-label">&nbsp;</label>
                <div style="display: flex; gap: 10px;">
                    <button id="applyFilters" class="btn-filter">
                        <i class="fas fa-filter"></i> Terapkan Filter
                    </button>
                    <button id="resetFilters" class="btn" style="background: #6c757d;">
                        <i class="fas fa-redo"></i> Reset
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Results Section -->
    <section class="results-section" id="resultsSection">
        <div class="results-header">
            <div class="results-count" id="resultsCount">
                Menampilkan <span>0-0</span> dari <span>0</span> hasil
            </div>
            
            <div class="results-tabs">
                <button class="tab-btn active" data-tab="all">
                    <i class="fas fa-bus"></i> Semua Bus
                </button>
                <button class="tab-btn" data-tab="available">
                    <i class="fas fa-check-circle"></i> Tersedia
                </button>
                <button class="tab-btn" data-tab="featured">
                    <i class="fas fa-star"></i> Terpopuler
                </button>
                <button class="tab-btn" data-tab="cheapest">
                    <i class="fas fa-money-bill-wave"></i> Termurah
                </button>
            </div>
        </div>

        <!-- Bus Cards Container -->
        <div id="busCardsContainer" class="bus-cards-container">
            <!-- Diisi oleh JavaScript -->
        </div>

        <!-- Pagination -->
        <div id="pagination" class="pagination">
            <!-- Diisi oleh JavaScript -->
        </div>
    </section>

    <!-- Empty State (hidden by default) -->
    <div id="emptyState" class="empty-state" style="display: none;">
        <div class="empty-icon">
            <i class="fas fa-bus-slash"></i>
        </div>
        <h3>Tidak Ada Bus yang Ditemukan</h3>
        <p>Maaf, tidak ada bus yang sesuai dengan kriteria pencarian Anda. Coba ubah filter atau tanggal keberangkatan.</p>
        <button id="refreshResults" class="btn-refresh">
            <i class="fas fa-redo"></i> Refresh Hasil
        </button>
    </div>
</main>

<!-- Footer -->
<footer class="footer">
    <div class="container">
        <p>&copy; 2024 Bus Ticket Online. All rights reserved.</p>
        <div class="footer-links">
            <a href="#" class="footer-link">Syarat dan Ketentuan</a>
            <a href="#" class="footer-link">Kebijakan Privasi</a>
            <a href="#" class="footer-link">Bantuan</a>
            <a href="#" class="footer-link">Kontak Kami</a>
        </div>
    </div>
</footer>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/pembeli_hasilnya.js') }}"></script>

<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    // Inisialisasi tambahan
    document.addEventListener('DOMContentLoaded', function() {
        // Ambil data pencarian dari localStorage jika ada
        const searchData = localStorage.getItem('searchData');
        if (searchData) {
            try {
                appState.searchParams = JSON.parse(searchData);
            } catch (e) {
                console.error('Error parsing search data:', e);
            }
        }
        
        // Restore tab preference
        const savedTab = localStorage.getItem('resultsTab');
        if (savedTab) {
            const tabBtn = document.querySelector(`[data-tab="${savedTab}"]`);
            if (tabBtn) {
                tabBtn.click();
            }
        }
    });
</script>
{% endblock %}